# Docker Setup - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å LCT Backend1 —Å –ø–æ–º–æ—â—å—é Docker, –≤–∫–ª—é—á–∞—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (MinIO).

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd lct_backend1

# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cp env.docker.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

### 2. –ó–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é Make (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫
make setup

# –ò–ª–∏ –ø–æ —à–∞–≥–∞–º:
make build    # –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
make up       # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```

### 3. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose build
docker-compose up -d

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec app alembic upgrade head
```

## üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:

- **üåê API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: http://localhost:8000
  - Swagger UI: http://localhost:8000/docs
  - Health check: http://localhost:8000/health

- **üóÑÔ∏è MinIO Console**: http://localhost:9001
  - –õ–æ–≥–∏–Ω: `minioadmin` / `minioadmin123`
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ S3 bucket'–∞–º–∏

- **üîÑ Nginx**: http://localhost:80
  - Reverse proxy –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

- **üìä PostgreSQL**: localhost:5432
  - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Make

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help          # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make up            # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make down          # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make logs          # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make logs-app      # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
make dev-up        # –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make dev-down      # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

# –ú–∏–≥—Ä–∞—Ü–∏–∏
make migrate       # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-create MESSAGE="–æ–ø–∏—Å–∞–Ω–∏–µ"  # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º
make shell         # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make db-shell      # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
make minio-shell   # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MinIO

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
make status        # –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make monitor       # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
make health        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make test          # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
make test-api      # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç API

# –ë—ç–∫–∞–ø—ã
make backup-db     # –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
make restore-db BACKUP=backup_file.sql  # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞

# –û—á–∏—Å—Ç–∫–∞
make clean         # –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ volumes
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (docker-compose.yml)
- PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- MinIO S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- Nginx reverse proxy

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (docker-compose.dev.yml)
- –¢–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (docker-compose.prod.yml)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)
- SSL –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ó–∞–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ `.env` —Ñ–∞–π–ª–µ:
```bash
DB_PASSWORD=your_secure_password_here
MINIO_ROOT_PASSWORD=your_secure_minio_password_here
GRAFANA_PASSWORD=your_secure_grafana_password_here
```

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose -f docker-compose.prod.yml up -d

# –ò–ª–∏ —á–µ—Ä–µ–∑ Make (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ Makefile)
make prod-up
```

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ volumes

```
volumes/
‚îú‚îÄ‚îÄ postgres_data/      # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
‚îú‚îÄ‚îÄ minio_data/         # –§–∞–π–ª—ã MinIO S3
‚îú‚îÄ‚îÄ nginx_logs/         # –õ–æ–≥–∏ Nginx
‚îú‚îÄ‚îÄ prometheus_data/    # –î–∞–Ω–Ω—ã–µ Prometheus
‚îî‚îÄ‚îÄ grafana_data/       # –î–∞–Ω–Ω—ã–µ Grafana
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker-compose logs -f app
docker-compose logs -f postgres
docker-compose logs -f minio
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º
```bash
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose exec app /bin/bash

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
docker-compose exec postgres psql -U postgres -d lct_backend1

# MinIO
docker-compose exec minio /bin/sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
docker network ls
docker network inspect lct_backend1_lct_network
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose build app
docker-compose up -d app

# –ò–ª–∏ —á–µ—Ä–µ–∑ Make
make restart-app
```

### –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å, –∑–∞–ø—É—Å—Ç–∏—Ç—å
make down
make build
make up
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏
- –î–æ—Å—Ç—É–ø: http://localhost:9090
- –ú–µ—Ç—Ä–∏–∫–∏ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ PostgreSQL –∏ MinIO

### Grafana –¥–∞—à–±–æ—Ä–¥—ã
- –î–æ—Å—Ç—É–ø: http://localhost:3000
- –õ–æ–≥–∏–Ω: `admin` / –ø–∞—Ä–æ–ª—å –∏–∑ `.env`
- –ì–æ—Ç–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –ø–æ—Ä—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
netstat -tulpn | grep :8000
netstat -tulpn | grep :5432

# –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã –≤ docker-compose.yml
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã –∏ volumes
docker system prune -a --volumes

# –ò–ª–∏ —á–µ—Ä–µ–∑ Make
make clean
```

### –ü—Ä–æ–±–ª–µ–º–∞: MinIO –Ω–µ —Å–æ–∑–¥–∞–µ—Ç bucket
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ minio-setup
docker-compose logs minio-setup

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å bucket –≤—Ä—É—á–Ω—É—é
docker-compose exec minio-setup sh
mc alias set minio http://minio:9000 minioadmin minioadmin123
mc mb minio/lct-backend1-images --ignore-existing
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PostgreSQL –≥–æ—Ç–æ–≤
docker-compose exec postgres pg_isready -U postgres

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec app env | grep DATABASE_URL

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
docker-compose exec app alembic upgrade head
```

## üèóÔ∏è –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
1. –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–∏—Å –≤ `docker-compose.yml`
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ç—å `lct_network`
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏—Ç–µ nginx.conf

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã –≤ `docker-compose.yml`
2. –û–±–Ω–æ–≤–∏—Ç–µ nginx.conf –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
3. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ SSL
1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –ø–∞–ø–∫—É `ssl/`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose.prod.yml`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ nginx.prod.conf

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Docker volumes:
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `docker-compose logs app`
- Nginx: volume `nginx_logs`
- PostgreSQL: `docker-compose logs postgres`
- MinIO: `docker-compose logs minio`

–î–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ELK stack –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.
